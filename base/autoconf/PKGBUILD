#!/bin/bash

pkgname=autoconf
pkgver=2.71
archive=$pkgname-$pkgver.tar.gz
sum=abe5a4bcf06ebd1bbbf81007159df346f5c1db8b

dstdir=$mkToolchainBase

build() {
  download https://ftp.gnu.org/gnu/$pkgname/$archive
  check $archive $sum
  extract $archive

  pushd $pkgname-$pkgver
    message "Configuring $pkgname-$pkgver"
    ./configure --build=$TARGET --prefix="$dstdir" \
                --mandir="$dstdir"/share/man \
                --infodir="$dstdir"/share/info
    message "Compiling $pkgname"
    make
  popd
}

package() {
  # installing
  make -C $pkgname-$pkgver install

  mv -vf "$dstdir"/share/autoconf{,-$pkgver}
  mv -vf "$dstdir"/share/info/autoconf{,-$pkgver}.info
  mv -vf "$dstdir"/share/info/standards{,-$pkgver}.info

  # link to the last version
  ln -vsf autoconf-$pkgver "$dstdir"/share/autoconf
  ln -vsf autoconf-$pkgver.info "$dstdir"/share/info/autoconf.info
  ln -vsf standards-$pkgver.info "$dstdir"/share/info/standards.info
  for exe in autoconf autoheader autom4te autoreconf autoscan autoupdate ifnames; do
    ln -vsf $exe-$pkgver "$dstdir"/bin/$exe
  done
  for doc in autoconf autoheader autom4te autoreconf autoscan autoupdate config.guess config.sub ifnames; do
    ln -vsf $doc-$pkgver.1 "$dstdir"/share/man/man1/$doc.1
  done
}
